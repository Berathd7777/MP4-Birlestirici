<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>🎥 MP4 Videoları Birleştirici</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Roboto", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #667eea;
      font-size: 2rem;
      margin: 0 0 10px 0;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    .input-section {
      margin-bottom: 25px;
    }
    .input-section label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
      font-size: 1.05rem;
    }
    input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 2px dashed #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background: #f9f9f9;
    }
    input[type="file"]:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 0.95rem;
      transition: all 0.3s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }
    .divider {
      text-align: center;
      margin: 15px 0;
      color: #999;
      font-size: 0.9rem;
    }
    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 30px;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #progress {
      margin-top: 30px;
      background: #f5f5f5;
      padding: 20px;
      border-radius: 12px;
      display: none;
    }
    .step {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      color: #666;
      transition: all 0.3s;
    }
    .step-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s;
    }
    .step.active {
      color: #667eea;
      font-weight: 600;
    }
    .step.active .step-icon {
      background: #667eea;
      color: white;
      animation: pulse 1.5s infinite;
    }
    .step.done {
      color: #4caf50;
    }
    .step.done .step-icon {
      background: #4caf50;
      color: white;
    }
    .step.error {
      color: #f44336;
    }
    .step.error .step-icon {
      background: #f44336;
      color: white;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    #log {
      margin-top: 15px;
      background: #2d2d2d;
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .alert {
      background: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <span class="material-symbols-outlined">movie_filter</span>
      MP4 Birleştirici
    </h1>
    <p class="subtitle">Intro videonuzu ana videonun başına ekleyin</p>

    <div class="input-section">
      <label>🎬 Intro Videosu (Başa Eklenecek)</label>
      <input id="introFile" type="file" accept="video/mp4">
    </div>

    <div class="input-section">
      <label>🎥 Ana Video</label>
      <input id="mainFile" type="file" accept="video/mp4">
      <div class="divider">— veya —</div>
      <input id="videoUrl" type="text" placeholder="Herkese açık MP4 linki yapıştırın">
    </div>

    <button class="btn" id="runBtn">
      <span class="material-symbols-outlined">rocket_launch</span>
      Birleştir ve İndir
    </button>
    
    <div id="progress">
      <div class="step" data-step="0">
        <div class="step-icon">
          <span class="material-symbols-outlined">settings</span>
        </div>
        <span class="text">FFmpeg motoru hazırlanıyor...</span>
      </div>
      <div class="step" data-step="1">
        <div class="step-icon">
          <span class="material-symbols-outlined">upload</span>
        </div>
        <span class="text">Intro videosu yükleniyor...</span>
      </div>
      <div class="step" data-step="2">
        <div class="step-icon">
          <span class="material-symbols-outlined">download</span>
        </div>
        <span class="text">Ana video yükleniyor...</span>
      </div>
      <div class="step" data-step="3">
        <div class="step-icon">
          <span class="material-symbols-outlined">merge</span>
        </div>
        <span class="text">Videolar birleştiriliyor...</span>
      </div>
      <div class="step" data-step="4">
        <div class="step-icon">
          <span class="material-symbols-outlined">download_done</span>
        </div>
        <span class="text">İndirme hazırlanıyor...</span>
      </div>
    </div>
    
    <div id="log"></div>
  </div>

  <script type="module">
    import { FFmpeg } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/esm/index.js';
    import { fetchFile, toBlobURL } from 'https://unpkg.com/@ffmpeg/util@0.12.1/dist/esm/index.js';

    const introInput = document.getElementById('introFile');
    const mainInput = document.getElementById('mainFile');
    const urlInput = document.getElementById('videoUrl');
    const runBtn = document.getElementById('runBtn');
    const logEl = document.getElementById('log');
    const progressDiv = document.getElementById('progress');
    const steps = document.querySelectorAll('.step');

    let ffmpeg = null;

    function log(msg) {
      console.log(msg);
      logEl.textContent += msg + '\n';
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateStep(index, status) {
      const step = steps[index];
      if (!step) return;
      
      steps.forEach(s => s.classList.remove('active', 'done', 'error'));
      
      if (status === 'active') {
        step.classList.add('active');
      } else if (status === 'done') {
        step.classList.add('done');
        const icon = step.querySelector('.step-icon .material-symbols-outlined');
        icon.textContent = 'check_circle';
      } else if (status === 'error') {
        step.classList.add('error');
        const icon = step.querySelector('.step-icon .material-symbols-outlined');
        icon.textContent = 'error';
      }
    }

    async function loadFFmpeg() {
      if (ffmpeg) return ffmpeg;
      
      log('FFmpeg başlatılıyor...');
      ffmpeg = new FFmpeg();
      
      ffmpeg.on('log', ({ message }) => {
        log(message);
      });
      
      ffmpeg.on('progress', ({ progress, time }) => {
        log(`İlerleme: ${(progress * 100).toFixed(2)}%`);
      });

      const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm';
      await ffmpeg.load({
        coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),
        wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),
      });
      
      log('FFmpeg hazır!');
      return ffmpeg;
    }

    runBtn.onclick = async () => {
      // Kontroller
      if (!introInput.files[0]) {
        alert('Lütfen bir intro videosu seçin!');
        return;
      }
      
      if (!mainInput.files[0] && !urlInput.value.trim()) {
        alert('Lütfen bir ana video dosyası seçin veya link girin!');
        return;
      }

      // Başlat
      runBtn.disabled = true;
      progressDiv.style.display = 'block';
      logEl.style.display = 'block';
      logEl.textContent = '';

      try {
        // Adım 0: FFmpeg yükle
        updateStep(0, 'active');
        await loadFFmpeg();
        updateStep(0, 'done');
        
        // Adım 1: Intro yükle
        updateStep(1, 'active');
        log('Intro videosu yükleniyor...');
        const introData = await fetchFile(introInput.files[0]);
        await ffmpeg.writeFile('intro.mp4', introData);
        log('Intro yüklendi!');
        updateStep(1, 'done');
        
        // Adım 2: Ana video yükle
        updateStep(2, 'active');
        let mainData;
        if (mainInput.files[0]) {
          log('Ana video dosyadan yükleniyor...');
          mainData = await fetchFile(mainInput.files[0]);
        } else {
          log('Ana video linkten indiriliyor...');
          mainData = await fetchFile(urlInput.value.trim());
        }
        await ffmpeg.writeFile('main.mp4', mainData);
        log('Ana video yüklendi!');
        updateStep(2, 'done');
        
        // Adım 3: Birleştir
        updateStep(3, 'active');
        log('Videolar birleştiriliyor...');
        await ffmpeg.writeFile('list.txt', 'file intro.mp4\nfile main.mp4');
        await ffmpeg.exec(['-f', 'concat', '-safe', '0', '-i', 'list.txt', '-c', 'copy', 'output.mp4']);
        log('Birleştirme tamamlandı!');
        updateStep(3, 'done');
        
        // Adım 4: İndir
        updateStep(4, 'active');
        log('Video indiriliyor...');
        const data = await ffmpeg.readFile('output.mp4');
        const blob = new Blob([data.buffer], { type: 'video/mp4' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'birlesik_video.mp4';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        log('İndirme başarılı!');
        updateStep(4, 'done');
        
        alert('✅ Video başarıyla birleştirildi ve indirildi!');
        
      } catch (error) {
        console.error('Hata:', error);
        log(`HATA: ${error.message}`);
        updateStep(Array.from(steps).findIndex(s => s.classList.contains('active')), 'error');
        alert('❌ Bir hata oluştu. Lütfen konsolu (F12) kontrol edin.');
      } finally {
        runBtn.disabled = false;
      }
    };
  </script>
</body>
</html>
