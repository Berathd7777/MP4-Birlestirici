<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>üé• MP4 Videolarƒ± Birle≈ütirici</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Roboto", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #667eea;
      font-size: 2rem;
      margin: 0 0 10px 0;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin-bottom: 25px;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #1565c0;
    }
    .input-section {
      margin-bottom: 25px;
    }
    .input-section label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
      font-size: 1.05rem;
    }
    input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 2px dashed #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background: #f9f9f9;
    }
    input[type="file"]:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 0.95rem;
      transition: all 0.3s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }
    .divider {
      text-align: center;
      margin: 15px 0;
      color: #999;
      font-size: 0.9rem;
    }
    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 30px;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #progress {
      margin-top: 30px;
      background: #f5f5f5;
      padding: 20px;
      border-radius: 12px;
      display: none;
    }
    .step {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      color: #666;
      transition: all 0.3s;
    }
    .step-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s;
    }
    .step.active {
      color: #667eea;
      font-weight: 600;
    }
    .step.active .step-icon {
      background: #667eea;
      color: white;
      animation: pulse 1.5s infinite;
    }
    .step.done {
      color: #4caf50;
    }
    .step.done .step-icon {
      background: #4caf50;
      color: white;
    }
    .step.error {
      color: #f44336;
    }
    .step.error .step-icon {
      background: #f44336;
      color: white;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    #log {
      margin-top: 15px;
      background: #2d2d2d;
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <span class="material-symbols-outlined">movie_filter</span>
      MP4 Birle≈ütirici
    </h1>
    <p class="subtitle">Intro videonuzu ana videonun ba≈üƒ±na ekleyin</p>

    <div class="info-box">
      ‚ö†Ô∏è <strong>√ñnemli:</strong> Bu ara√ß videolarƒ± doƒürudan tarayƒ±cƒ±da birle≈ütirir. B√ºy√ºk dosyalar i√ßin bilgisayarƒ±nƒ±zƒ±n yeterli belleƒüi olmalƒ±.
    </div>

    <div class="input-section">
      <label>üé¨ Intro Videosu (Ba≈üa Eklenecek)</label>
      <input id="introFile" type="file" accept="video/mp4">
    </div>

    <div class="input-section">
      <label>üé• Ana Video</label>
      <input id="mainFile" type="file" accept="video/mp4">
      <div class="divider">‚Äî veya ‚Äî</div>
      <input id="videoUrl" type="text" placeholder="Herkese a√ßƒ±k MP4 linki yapƒ±≈ütƒ±rƒ±n">
    </div>

    <button class="btn" id="runBtn">
      <span class="material-symbols-outlined">rocket_launch</span>
      Birle≈ütir ve ƒ∞ndir
    </button>
    
    <div id="progress">
      <div class="step" data-step="0">
        <div class="step-icon">
          <span class="material-symbols-outlined">upload</span>
        </div>
        <span class="text">Intro videosu okunuyor...</span>
      </div>
      <div class="step" data-step="1">
        <div class="step-icon">
          <span class="material-symbols-outlined">download</span>
        </div>
        <span class="text">Ana video okunuyor...</span>
      </div>
      <div class="step" data-step="2">
        <div class="step-icon">
          <span class="material-symbols-outlined">merge</span>
        </div>
        <span class="text">Videolar birle≈ütiriliyor...</span>
      </div>
      <div class="step" data-step="3">
        <div class="step-icon">
          <span class="material-symbols-outlined">download_done</span>
        </div>
        <span class="text">Video indiriliyor...</span>
      </div>
    </div>
    
    <div id="log"></div>
  </div>

  <script>
    const introInput = document.getElementById('introFile');
    const mainInput = document.getElementById('mainFile');
    const urlInput = document.getElementById('videoUrl');
    const runBtn = document.getElementById('runBtn');
    const logEl = document.getElementById('log');
    const progressDiv = document.getElementById('progress');
    const steps = document.querySelectorAll('.step');

    function log(msg) {
      console.log(msg);
      logEl.textContent += msg + '\n';
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateStep(index, status) {
      const step = steps[index];
      if (!step) return;
      
      steps.forEach(s => s.classList.remove('active', 'done', 'error'));
      
      if (status === 'active') {
        step.classList.add('active');
      } else if (status === 'done') {
        step.classList.add('done');
        const icon = step.querySelector('.step-icon .material-symbols-outlined');
        icon.textContent = 'check_circle';
      } else if (status === 'error') {
        step.classList.add('error');
        const icon = step.querySelector('.step-icon .material-symbols-outlined');
        icon.textContent = 'error';
      }
    }

    async function readFileAsArrayBuffer(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }

    async function fetchVideoAsArrayBuffer(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error('Video indirilemedi');
      return await response.arrayBuffer();
    }

    async function mergeMP4Files(intro, main) {
      // MP4 dosyalarƒ±nƒ± basit bir ≈üekilde birle≈ütir
      // Not: Bu method sadece uyumlu codec'ler i√ßin √ßalƒ±≈üƒ±r
      const introArray = new Uint8Array(intro);
      const mainArray = new Uint8Array(main);
      
      // ƒ∞ki arraybuffer'ƒ± birle≈ütir
      const merged = new Uint8Array(introArray.length + mainArray.length);
      merged.set(introArray, 0);
      merged.set(mainArray, introArray.length);
      
      return merged.buffer;
    }

    runBtn.onclick = async () => {
      // Kontroller
      if (!introInput.files[0]) {
        alert('L√ºtfen bir intro videosu se√ßin!');
        return;
      }
      
      if (!mainInput.files[0] && !urlInput.value.trim()) {
        alert('L√ºtfen bir ana video dosyasƒ± se√ßin veya link girin!');
        return;
      }

      // Ba≈ülat
      runBtn.disabled = true;
      progressDiv.style.display = 'block';
      logEl.style.display = 'block';
      logEl.textContent = '';

      try {
        // Adƒ±m 0: Intro oku
        updateStep(0, 'active');
        log('Intro videosu okunuyor...');
        const introBuffer = await readFileAsArrayBuffer(introInput.files[0]);
        log(`Intro y√ºklendi: ${(introBuffer.byteLength / 1024 / 1024).toFixed(2)} MB`);
        updateStep(0, 'done');
        
        // Adƒ±m 1: Ana video oku
        updateStep(1, 'active');
        let mainBuffer;
        if (mainInput.files[0]) {
          log('Ana video dosyadan okunuyor...');
          mainBuffer = await readFileAsArrayBuffer(mainInput.files[0]);
        } else {
          log('Ana video linkten indiriliyor...');
          mainBuffer = await fetchVideoAsArrayBuffer(urlInput.value.trim());
        }
        log(`Ana video y√ºklendi: ${(mainBuffer.byteLength / 1024 / 1024).toFixed(2)} MB`);
        updateStep(1, 'done');
        
        // Adƒ±m 2: Birle≈ütir
        updateStep(2, 'active');
        log('Videolar birle≈ütiriliyor...');
        const mergedBuffer = await mergeMP4Files(introBuffer, mainBuffer);
        log(`Birle≈ütirildi: ${(mergedBuffer.byteLength / 1024 / 1024).toFixed(2)} MB`);
        updateStep(2, 'done');
        
        // Adƒ±m 3: ƒ∞ndir
        updateStep(3, 'active');
        log('Video indiriliyor...');
        const blob = new Blob([mergedBuffer], { type: 'video/mp4' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'birlesik_video.mp4';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        log('ƒ∞ndirme ba≈üarƒ±lƒ±!');
        updateStep(3, 'done');
        
        alert('‚úÖ Video ba≈üarƒ±yla birle≈ütirildi ve indirildi!\n\n‚ö†Ô∏è Not: Eƒüer video d√ºzg√ºn oynatƒ±lmƒ±yorsa, videolarƒ±n codec uyumluluƒüu nedeniyle olabilir. Bu durumda masa√ºst√º bir video d√ºzenleme programƒ± kullanmanƒ±z √∂nerilir.');
        
      } catch (error) {
        console.error('Hata:', error);
        log(`HATA: ${error.message}`);
        const activeStepIndex = Array.from(steps).findIndex(s => s.classList.contains('active'));
        if (activeStepIndex >= 0) updateStep(activeStepIndex, 'error');
        alert('‚ùå Bir hata olu≈ütu: ' + error.message + '\n\nL√ºtfen konsolu (F12) kontrol edin.');
      } finally {
        runBtn.disabled = false;
      }
    };
  </script>
</body>
</html>
